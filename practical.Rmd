---
title: "Statistical Analysis of Biological Data"
author: "Mark Dunning"
date: "8 July 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Part I

## How to test for normality

We will read some example data to illustrate how one would test for a normally-distributed variable. This property is important as it influences which test we should use.


First we will load the `tidyverse` set of packages that are recommended for data manipulation and visualisation. The data for this first section are to be found in the file `normal_example.csv` in the `data` folder. You will need to specify the file path accordingly.

```{r message=FALSE}
library(tidyverse)
df1 <- read_csv("data/normal_example.csv")
```

We can inspect the data in RStudio and discover that it consists of a single column called `x` that comprises numeric observations

```{r}
View(df1)
```

Various graphical methods are available to assess the distrbution. The first of which is a *histogram*. Here, the data are split into bins (`ggplot2` choses the number of bins) and the value on the `y` axis corresponds to the number of observations in that bin. The user only has to specify the variable to be plotted, and `ggplot2` takes care of the binning.

```{r}
ggplot(df1, aes(x=x)) + geom_histogram()
```

A similar option is to produce a density curve. Here the y-axis is the *density* points with a particular value.

```{r}
ggplot(df1, aes(x = x)) + geom_density()
```

The third option is a the boxplot which shows the median, and quartiles of the distribution.

```{r}
ggplot(df1, aes(x="",y=x)) + geom_violin(alpha=0.4) + geom_boxplot(alpha=0.4)
```



```{r}
ggplot(df1,aes(sample=x)) + geom_qq() + geom_qq_line(col="red")
```


Now lets read some more realistic data

```{r}
df2 <- read_csv("data/toy_example.csv")
```

## Using the histogram

```{r}
ggplot(df2, aes(x = x)) + geom_histogram()
```

```{r}
ggplot(df2, aes(x = y)) + geom_histogram()
```



## Using a boxplot

```{r}
  ggplot(df2,aes(x="",y=x)) + geom_boxplot()
```

```{r}
ggplot(df2,aes(x="",y=x)) + geom_boxplot()
```


## The qqplot

```{r}
ggplot(df1,aes(sample=x)) + geom_qq() + geom_qq_line(col="red")
```


## Tests for normality


```{r}
#shapiro test
shapiro.test(df1$x)
shapiro.test(df2$x)
shapiro.test(df2$y)
```

```{r}
#kolomogorov-Smirnov test
ks.test(df1$x,"pnorm", mean=mean(df1$x), sd=sd(df1$x))
```

## Summary Statistics

```{r}
summarise(df2, mean(x), median(x), IQR(x))
```


```{r}
library(psych)

describe(df2)

```


## Tidy data

```{r}
df2
```

```{r}
df2 %>% gather
```

```{r}
df2 %>% gather %>% 
  group_by(key) %>% 
  summarise(mean(value))
```

```{r}
df2 %>% gather %>% 
  ggplot(aes(x = key, y=value,fill=key)) + geom_boxplot()
```

# Part 2


```{r}
library(vcd)
Arthritis
```


```{r}
group_by(Arthritis, Sex) %>% 
  summarise(N = n()) %>% 
  mutate(prop = prop.table(N))
```

```{r}
group_by(Arthritis, Sex, Improved) %>% 
  summarise(N = n()) %>% 
  mutate(prop = prop.table(N))
```

```{r}
group_by(Arthritis, Improved, Sex) %>% 
  summarise(N = n()) %>% 
  mutate(prop = prop.table(N))
```

```{r}
group_by(Arthritis, Improved, Treatment) %>% 
  summarise(N = n()) %>% 
  spread(Improved, N) %>%
  select(-Treatment) %>% 
  chisq.test()
```

```{r}
group_by(Arthritis, Improved, Sex) %>% 
  summarise(N = n()) %>% 
  spread(Improved, N) %>%
  select(-Sex) %>% 
  chisq.test()
```

```{r}
group_by(Arthritis, Improved, Sex) %>% 
  summarise(N = n()) %>% 
  spread(Improved, N) %>%
  select(-Sex) %>% 
  fisher.test()
```

```{r}
group_by(Arthritis, Sex, Improved, Treatment) %>% 
  summarise(N = n())
```
```{r}
group_by(Arthritis, Improved, Sex) %>% 
  summarise(N = n()) %>% 
  ggplot(aes(x = Sex, y=Improved,fill=N)) + geom_tile()
```

# Part 3

```{r}
set.seed(20190717)

#make some data
season <- sample(c("spring","summer","autumn","winter"),50,TRUE)
E <- rnorm(50,5,6)
F <- rnorm(50,7.8,4.5)
G <- rnorm(50,65,16.7)

rates <- data.frame(season,E,F,G) 
# in excel the grouping variable must be 'character' not numbers
head(rates)
```

```{r}
rates %>% gather(variable, value, -season) %>%
  ggplot(aes(x = variable, y = value)) + geom_boxplot() + geom_jitter(width=0.1)
```

# Compare between TWO GROUPS 
# A] Parametric (T test)

# 1-independant t test.......TWO independant groups 

#select 2 groups to compare

```{r}
rates1 <- rates %>% gather(variable, value, -season) %>%
  filter(season %in% c("summer","winter"),variable=="E")
rates1
```

```{r}
t.test(value ~ season, data=rates1)
```

```{r}
rates2 <- rates %>% gather(variable, value, -season) %>%
  filter(variable %in% c("E","F"), season %in% c("summer","winter"))
rates2
```


```{r}
t.test(value~variable,data=rates2)
```

## How to test if variances are equal?

```{r}
rates2 %>% group_by(variable) %>% 
  summarise(Variance=var(value))
```

```{r}
rates2 %>% 
  ggplot(aes(x = variable,y=value)) + geom_boxplot()
```
```{r}
t.test(value~variable,data=rates2,paired=TRUE)
```

```{r}
rates3 <- rates %>% gather(variable, value, -season) %>%
  filter(variable=="F")

pairwise.t.test(rates3$value,rates3$season)  
```

# Compare between TWO GROUPS 
# B] Non- Parametric (Wilcoxon test)

#1-Independant samples = Wilcoxon rank sum test (Mann Whitney U test)


```{r}
wilcox.test(value~season, data=rates1)
```

```{r}
wilcox.test(value~variable,data=rates2)
```

#2-Paired samples = Wilcoxon signed rank test

```{r}
wilcox.test(value~variable,data=rates2,paired=TRUE)
```

# Compare between MORE THAN TWO GROUPS 
# A] Non-Parametric (Kruskal Wallis)

#1-Independant samples = kruskal Wallis

```{r}
rates_e <- rates %>% gather(variable, value, -season) %>%
  filter(variable=="E")
rates_e

```

```{r}
kruskal.test(value ~ season, data=rates_e)
```

```{r}
###CHECK#
rates %>% gather(variable, value, -season) %>%
  kruskal.test(value ~ variable, data=.)
```

# Compare between MORE THAN TWO GROUPS 
# B] Parametric (ANOVA)


```{r}
anova <- aov(value ~ season, data=rates_e)
anova
summary(anova)
```

```{r}
set.seed(5)
E <- rnorm(50,5,6)
F <- rnorm(50,7.8,4.5)
G <- c(50:99)

```

```{r}
anova <- data.frame(E,F,G) %>% gather %>% 
  aov(value ~ key, data=.)
anova
summary(anova)
```

```{r}
TukeyHSD(anova)
```

```{r}
plot(TukeyHSD(anova))
```

## Two-way ANOVA

```{r}
medulloblastoma <- readxl::read_xlsx("data/Medulloblastoma.xlsx")
```
```{r}
twoway <- aov(`C-myc` ~ Site + Size,data=medulloblastoma)
summary(twoway)
```

```{r}
ggplot(medulloblastoma,aes(x = Metastasis, y=`C-myc`)) + geom_boxplot()
```

