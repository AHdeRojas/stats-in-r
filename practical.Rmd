---
title: "Statistical Analysis of Biological Data"
author: "Mark Dunning"
date: "8 July 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Part I

## How to test for normality


```{r}
library(tidyverse)
df1 <- read_csv("data/normal_example.csv")
```

```{r}
ggplot(df1, aes(x=x)) + geom_histogram()
```

```{r}
ggplot(df1, aes(x = x)) + geom_density()
```

```{r}
ggplot(df1,aes(sample=x)) + geom_qq() + geom_qq_line(col="red")
```


Now lets read some more realistic data

```{r}
df2 <- read_csv("data/toy_example.csv")
```

## Using the histogram

```{r}
ggplot(df2, aes(x = x)) + geom_histogram()
```

```{r}
ggplot(df2, aes(x = y)) + geom_histogram()
```



## Using a boxplot

```{r}
  ggplot(df2,aes(x="",y=x)) + geom_boxplot()
```

```{r}
ggplot(df2,aes(x="",y=x)) + geom_boxplot()
```


## The qqplot

```{r}
ggplot(df1,aes(sample=x)) + geom_qq() + geom_qq_line(col="red")
```


## Tests for normality


```{r}
#shapiro test
shapiro.test(df1$x)
shapiro.test(df2$x)
shapiro.test(df2$y)
```

```{r}
#kolomogorov-Smirnov test
ks.test(df1$x,"pnorm", mean=mean(df1$x), sd=sd(df1$x))
```

## Summary Statistics

```{r}
summarise(df2, mean(x), median(x), IQR(x))
```


```{r}
library(psych)

describe(df2)

```


## Tidy data

```{r}
df2
```

```{r}
df2 %>% gather
```

```{r}
df2 %>% gather %>% 
  group_by(key) %>% 
  summarise(mean(value))
```

```{r}
df2 %>% gather %>% 
  ggplot(aes(x = key, y=value,fill=key)) + geom_boxplot()
```

# Part II 


```{r}
library(vcd)
Arthritis
```


```{r}
group_by(Arthritis, Sex) %>% 
  summarise(N = n()) %>% 
  mutate(prop = prop.table(N))
```

```{r}
group_by(Arthritis, Sex, Improved) %>% 
  summarise(N = n()) %>% 
  mutate(prop = prop.table(N))
```

```{r}
group_by(Arthritis, Improved, Sex) %>% 
  summarise(N = n()) %>% 
  mutate(prop = prop.table(N))
```

```{r}
group_by(Arthritis, Improved, Treatment) %>% 
  summarise(N = n()) %>% 
  spread(Improved, N) %>%
  select(-Treatment) %>% 
  chisq.test()
```

```{r}
group_by(Arthritis, Improved, Sex) %>% 
  summarise(N = n()) %>% 
  spread(Improved, N) %>%
  select(-Sex) %>% 
  chisq.test()
```

```{r}
group_by(Arthritis, Improved, Sex) %>% 
  summarise(N = n()) %>% 
  spread(Improved, N) %>%
  select(-Sex) %>% 
  fisher.test()
```

```{r}
group_by(Arthritis, Sex, Improved, Treatment) %>% 
  summarise(N = n())
```
```{r}
group_by(Arthritis, Improved, Sex) %>% 
  summarise(N = n()) %>% 
  ggplot(aes(x = Sex, y=Improved,fill=N)) + geom_tile()
```

```{r}

#make some data
season <- sample(c("spring","summer","autumn","winter"),50,TRUE)
E <- rnorm(50,5,6)
F <- rnorm(50,7.8,4.5)
G <- rnorm(50,65,16.7)

rates <- data.frame(season,E,F,G) 
# in excel the grouping variable must be 'character' not numbers
head(rates)
```

```{r}
rates %>% gather(variable, value, -season) %>%
  ggplot(aes(x = variable, y = value)) + geom_boxplot() + geom_jitter(width=0.1)
```

# Compare between TWO GROUPS 
# A] Parametric (T test)

# 1-independant t test.......TWO independant groups 

#select 2 groups to compare

```{r}
rates1 <- rates %>% gather(variable, value, -season) %>%
  filter(season %in% c("summer","winter"),variable=="E")
rates1
```

```{r}
t.test(value ~ season, data=rates1)
```

```{r}
rates2 <- rates %>% gather(variable, value, -season) %>%
  filter(variable %in% c("E","F"))
rates2
```


```{r}
t.test(value~variable,data=rates2)
```

## How to test if variances are equal?

```{r}
rates2 %>% group_by(variable) %>% 
  summarise(Variance=var(value))
```

```{r}
rates2 %>% 
  ggplot(aes(x = variable,y=value)) + geom_boxplot()
```
```{r}
t.test(value~variable,data=rates2,paired=TRUE)
```

```{r}
rates3 <- rates %>% gather(variable, value, -season) %>%
  filter(variable=="F")

pairwise.t.test(rates3$value,rates3$season)  
```

# Compare between TWO GROUPS 
# B] Non- Parametric (Wilcoxon test)

#1-Independant samples = Wilcoxon rank sum test (Mann Whitney U test)


```{r}
wilcox.test(value~season, data=rates1)
```

```{r}
wilcox.test(value~variable,data=rates2)
```

#2-Paired samples = Wilcoxon signed rank test

```{r}
wilcox.test(value~variable,data=rates2,paired=TRUE)
```

# Compare between MORE THAN TWO GROUPS 
# A] Non-Parametric (Kruskal Wallis)

#1-Independant samples = kruskal Wallis

```{r}
rates_e <- rates %>% gather(variable, value, -season) %>%
  filter(variable=="E")
rates_e

```
```{r}
kruskal.test(value ~ season, data=rates_e)
```

```{r}
rates %>% gather(variable, value, -season) %>%
  kruskal.test(value ~ season, data=.)
```



kruskal.test(rates$E ~ rates$season)
kruskal.test(rates$E, rates$F, rates$G)

#post hoc test
install.packages("dunn.test")
library(dunn.test)
dunn.test(ttest$E,ttest$group, method = "Bonferroni")
?dunn.test

#2-Dependant samples = Friedman
rates2 <- subset(rates, select = c(E, F, G))
friedman.test(as.matrix(rates2))
